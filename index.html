<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HDS Tokens</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    /* Fixed left navigation styles */
    .layout {
        display: flex;
        gap: 20px;
    }
    
    

    ul {
      padding: 0;
      margin: 0;
    }

    #left-nav {
      display: flex;
      position: sticky;
      top: 36px;
      left: 0;
      width: 200px;
      height: 100vh;
      overflow-y: auto;
      padding: 12px;
      box-sizing: border-box;
      border-right: 1px solid #ddd;
      background-color: #fff;
    }
    #left-nav ul {
      list-style-type: none;
      padding: 0;
    }
    #left-nav li {
      margin-bottom: 10px;
    }
    #left-nav a {
      text-decoration: none;
      color: #007bff;
      cursor: pointer;
    }
    #left-nav a:hover {
      text-decoration: underline;
    }
    /* Main content area */
    #main-content {
      padding: 20px;
    }
    h1 {
      padding: 0;
      margin: 0 0 20px 0;
      font-size: 24px;
    }
    .file-tabs {
      display: flex;
      position: sticky;
      top: 0;
      box-sizing: border-box;
      gap: 0;
      border-bottom: 1px inset #ddd;
      margin-bottom: 15px;
      height: 36px;
      background: #fff;
    }
    .small {
      font-size: 13px;
      font-weight: 500;
      line-height: 20px;
      display: inline-block;
    }
    .small-bold {
      font-size: 14px;
      font-weight: 600;
      line-height: 20px;
      display: inline-block;
    }
    .file-tab {
      padding: 8px 16px;
      cursor: pointer;
      border: none;
      width: 112px;
      background-color: #ffffff;
    }
    .file-tab.active {
      background-color: #ffffff;
      font-weight: 600;
      border-bottom: 3px solid #26b439;
    }

    #file-contents {
      width: 100%;
    }

    .file-content {
      display: none;
    }
    .file-content.active {
      display: flex;
      flex-direction: column;
      width: 100%;
    }
    .view-toggle-btn {
      padding: 5px 10px;
      margin-right: 10px;
      cursor: pointer;
      border: 1px solid #ddd;
      background-color: #eee;
    }
    .view-toggle-btn.active {
      background-color: #ccc;
    }
    .copy-btn {
      float: right;
      padding: 5px 10px;
      cursor: pointer;
      border: none;
      background: #007bff;
      color: white;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
    }

   

    th, td {
      border-left: 2px solid #ddd;
      padding: 8px 8px 8px 12px;
      height: 20px;
      text-align: left;
      vertical-align: middle;
      width: 33%;
    }
    
    table:not(table table) > tbody > tr > td,
table:not(table table) > tr > td {
  /* your styles here */
 border:none;
 padding-left: 0px;
}




    table:not(:has(table)) td {
  /* styles for td in the innermost table */
  border: none;
  border-bottom: 1px solid #ececec;
  border-top: 1px solid #ececec;
  border-left: 1px solid #ececec;
  padding: 4px 8px;
    }

    table:not(:has(table)) td:first-child {
  /* styles for td in the innermost table */
  border: none;
  border-bottom: 1px solid #ececec;
  border-left: 2px solid #ddd;
  border-top: 1px solid #ececec;
  padding: 4px 8px;
    }


    
    th {
      background-color: #f2f2f2;
    }
    .color-circle {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: inline-block;
      border: 1px solid #0000001c;
      margin-right: 5px;
      line-height: 20px;
    }
    .middle-flex {
      display: flex;
      align-items: center;
    }
    .table-view {
      display: block;
    }
    .table-view.hidden {
      display: none;
    }
    .json-view {
      display: none;
      border: 1px solid #ddd;
      background-color: #fafafa;
      padding: 10px;
      white-space: pre;
    }
    .json-view.active {
      display: block;
    }
  </style>
  <script>
    // Color and alias resolution functions
    function isValidColor(str) {
      const s = new Option().style;
      s.color = str;
      return s.color !== '';
    }
    function singleResolve(alias, tokenData) {
      const patterns = {
        'global-color': 'output_json/primitives.json',
        'light': 'output_json/light.json',
        'dark': 'output_json/dark.json'
      };
      const match = alias.match(/^{(global-color|light|dark)\.([^}]+)}$/);
      if (!match) return alias;
      const filePrefix = match[1];
      const pathParts = match[2].split('.');
      let refData = tokenData[patterns[filePrefix]];
      if (filePrefix === 'global-color' && refData['global-color']) {
        refData = refData['global-color'];
      }
      for (const part of pathParts) {
        if (refData && typeof refData === 'object' && part in refData) {
          refData = refData[part];
        } else {
          return alias;
        }
      }
      return refData?.value ?? refData ?? alias;
    }
    function fullyResolve(value, tokenData) {
      for (let i = 0; i < 10; i++) {
        if (typeof value !== 'string') break;
        const next = singleResolve(value, tokenData);
        if (next === value) break;
        value = next;
      }
      return value;
    }
    
    // Modified nested table builder that adds id attributes to group headers
    function buildNestedTable(obj, tokenData, prefix, isPrimitives, isSem) {
      let rowsHtml = '';
      let foundAnyRow = false;
      for (const key in obj) {
        const val = obj[key];
        const currentName = prefix ? prefix + '.' + key : key;
        if (typeof val === 'object' && !val?.value) {
          const nested = buildNestedTable(val, tokenData, currentName, isPrimitives);
          if (nested.foundValue) {
            foundAnyRow = true;
            const colSpan = isPrimitives ? 2 : 3;
            // Create an id using the group name with dots replaced by dashes
            rowsHtml += `
              <tr id="group-${currentName.replace(/\./g, '-')}">
                <td colspan="${colSpan}">
                  <span class="small small-bold">${currentName}</span>
                  ${nested.html}
                </td>
              </tr>
            `;
          }
        }
        else if (val && val.value) {
          foundAnyRow = true;
          const rawValue = val.value;
          const resolved = isPrimitives ? rawValue : fullyResolve(rawValue, tokenData);
          const looksHex = typeof resolved === 'string' && resolved.startsWith('#');
          const isColorType = val.type === 'color';
          const recognized = (typeof resolved === 'string' && isValidColor(resolved));
          let colorCell = resolved;
          if ((looksHex || isColorType || recognized) && typeof resolved === 'string') {
            colorCell = `<div class="middle-flex"><span class="color-circle" style="background-color: ${resolved};"></span><span class="medium">${resolved}</span></div>`;
          }
          if (isPrimitives) {
            rowsHtml += `
              <tr>
                <td><span class="small">${currentName}</span></td>
                <td><span class="small">${colorCell}</span></td>
              </tr>
            `;
          } else {
            rowsHtml += `
              <tr>
                <td><span class="small">${currentName}</span></td>
                <td><span class="small">${rawValue}</span></td>
                <td><span class="small">${colorCell}</span></td>
              </tr>
            `;
          }
        }
      }
      if (!foundAnyRow) {
        return {
          foundValue: false,
          html: ''
        };
      }
      let tableHeader = `<table>`;
      const finalHtml = `${tableHeader}${rowsHtml}</table>`;
      return {
        foundValue: true,
        html: finalHtml
      };
    }
    
    // Loads token data from JSON files and builds tabs and content areas
    async function loadTokens() {
      const files = [
        'output_json/primitives.json',
        'output_json/semantics.json',
        'output_json/light.json',
        'output_json/dark.json'
      ];
      const tokenData = {};
      for (const file of files) {
        try {
          const response = await fetch(file);
          if (!response.ok) throw new Error(`Failed to load ${file}`);
          tokenData[file] = await response.json();
        } catch(e) {
          console.error(e);
        }
      }
      const fileTabs = document.getElementById('file-tabs');
      const fileContents = document.getElementById('file-contents');
      const nameMap = {
        'output_json/primitives.json': 'Primitives',
        'output_json/semantics.json': 'Semantics',
        'output_json/light.json': 'Theme Light',
        'output_json/dark.json': 'Theme Dark'
      };
      for (const filePath of files) {
        const fileName = nameMap[filePath];
        const isPrimitives = filePath.includes('primitives');
        const isSemantics = filePath.includes('semantics');
        const data = tokenData[filePath] || {};
        const { foundValue, html } = buildNestedTable(data, tokenData, '', isPrimitives);
        const rawJSON = JSON.stringify(data, null, 2);
        const tabBtn = document.createElement('button');
        tabBtn.className = 'file-tab';
        tabBtn.textContent = fileName;
        tabBtn.onclick = () => activateFileTab(fileName);
        fileTabs.appendChild(tabBtn);
        const contentDiv = document.createElement('div');
        contentDiv.className = 'file-content';
        contentDiv.id = `file-content-${fileName}`;
        let tableHtml = foundValue ? html : `<p>No tokens with .value found here.</p>`;
        contentDiv.innerHTML = `
          <div>
            <button class="view-toggle-btn active" onclick="showTable('${fileName}')">Show Table</button>
            <button class="view-toggle-btn" onclick="showJSON('${fileName}')">Show Raw JSON</button>
            <button class="copy-btn" onclick="copyJSON('${fileName}')">Copy JSON</button>
          </div>
          <div id="table-${fileName}" class="table-view">
            ${tableHtml}
          </div>
          <pre id="json-${fileName}" class="json-view">${rawJSON}</pre>
        `;
        fileContents.appendChild(contentDiv);
      }
      if (files.length > 0) {
        const firstName = nameMap[files[0]];
        activateFileTab(firstName);
      }
    }
    
    function activateFileTab(tabName) {
      document.querySelectorAll('.file-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.file-content').forEach(fc => {
        fc.classList.remove('active');
      });
      const tabBtn = Array.from(document.querySelectorAll('.file-tab'))
        .find(b => b.textContent === tabName);
      if (tabBtn) tabBtn.classList.add('active');
      const contentDiv = document.getElementById(`file-content-${tabName}`);
      if (contentDiv) contentDiv.classList.add('active');
      showTable(tabName);
      updateLeftNav();
    }
    
    function showTable(tabName) {
      const parent = document.getElementById(`file-content-${tabName}`);
      if (!parent) return;
      const tableDiv = parent.querySelector('.table-view');
      const jsonDiv  = parent.querySelector('.json-view');
      parent.querySelectorAll('.view-toggle-btn').forEach(b => b.classList.remove('active'));
      const tableBtn = Array.from(parent.querySelectorAll('.view-toggle-btn'))
        .find(b => b.textContent.includes('Table'));
      if (tableBtn) tableBtn.classList.add('active');
      if (tableDiv) {
        tableDiv.classList.remove('hidden');
        tableDiv.style.display = 'block';
      }
      if (jsonDiv) {
        jsonDiv.classList.remove('active');
        jsonDiv.style.display = 'none';
      }
      updateLeftNav();
    }
    
    function showJSON(tabName) {
      const parent = document.getElementById(`file-content-${tabName}`);
      if (!parent) return;
      const tableDiv = parent.querySelector('.table-view');
      const jsonDiv  = parent.querySelector('.json-view');
      parent.querySelectorAll('.view-toggle-btn').forEach(b => b.classList.remove('active'));
      const jsonBtn = Array.from(parent.querySelectorAll('.view-toggle-btn'))
        .find(b => b.textContent.includes('Raw JSON'));
      if (jsonBtn) jsonBtn.classList.add('active');
      if (tableDiv) {
        tableDiv.classList.add('hidden');
        tableDiv.style.display = 'none';
      }
      if (jsonDiv) {
        jsonDiv.classList.add('active');
        jsonDiv.style.display = 'block';
      }
      // Clear left nav when showing raw JSON
      document.getElementById('left-nav').innerHTML = '';
    }
    
    function copyJSON(tabName) {
      const parent = document.getElementById(`file-content-${tabName}`);
      if (!parent) return;
      const jsonEl = parent.querySelector('.json-view');
      if (!jsonEl) return;
      const content = jsonEl.textContent;
      navigator.clipboard.writeText(content).then(() => {
        alert('JSON copied to clipboard!');
      });
    }
    
    // Build left navigation based on group headers in the active file's table view,
    // including only first and second level groups.
    function updateLeftNav() {
      const leftNav = document.getElementById('left-nav');
      leftNav.innerHTML = '';
      const activeContent = document.querySelector('.file-content.active');
      if (!activeContent) return;
      const groupRows = activeContent.querySelectorAll('tr[id^="group-"]');
      if (groupRows.length === 0) {
        leftNav.innerHTML = '<p>No token groups found.</p>';
        return;
      }
      const list = document.createElement('ul');
      groupRows.forEach(row => {
        const id = row.id;
        const text = row.querySelector('.small')?.textContent || id;
        // Only include groups that are first or second level (i.e. at most one dot)
        if (text.split('.').length <= 1) {
          const li = document.createElement('li');
          const link = document.createElement('a');
          link.href = '#' + id;
          link.textContent = text;
          link.addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
          });
          li.appendChild(link);
          list.appendChild(li);
        }
      });
      leftNav.appendChild(list);
    }
    
    document.addEventListener('DOMContentLoaded', loadTokens);
  </script>
</head>
<body>
  
<div id="main-content">
  <h1>HDS Tokens</h1>
  <div class="file-tabs" id="file-tabs"></div>
  <div class="layout">
    <div id="left-nav"></div>
    <div id="file-contents"></div>
  </div> 
</div>
</body>
</html>
